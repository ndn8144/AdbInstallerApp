<Window x:Class="AdbInstallerApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:AdbInstallerApp.ViewModels"
        xmlns:converters="clr-namespace:AdbInstallerApp.Converters"
        mc:Ignorable="d"
        Title="ADB Installer App" Height="800" Width="1400"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <converters:ModuleToVisibilityConverter x:Key="ModuleToVisibilityConverter"/>
    </Window.Resources>
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header Bar -->
        <Border Grid.Row="0" 
                Background="#2196F3" 
                Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Logo and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ðŸ“‹" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <TextBlock Text="ADB Installer App - Professional APK Management and Installation" 
                               FontSize="18" FontWeight="Bold" 
                               Foreground="White" VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Status Indicators -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Border Background="White" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                        <TextBlock Text="{Binding DevicesCountText, FallbackValue='0 Devices'}" 
                                   Foreground="#2196F3" FontWeight="SemiBold"/>
                    </Border>
                    <Border Background="White" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                        <TextBlock Text="{Binding ApkFilesCountText, FallbackValue='0 APKs'}" 
                                   Foreground="#2196F3" FontWeight="SemiBold"/>
                    </Border>
                    <Border Background="White" CornerRadius="4" Padding="8,4">
                        <TextBlock Text="Ready" Foreground="#2196F3" FontWeight="SemiBold"/>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Left Navigation Panel -->
            <Border Grid.Column="0" 
                    Background="White" 
                    BorderBrush="{StaticResource DividerBrush}" 
                    BorderThickness="0,0,1,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="0,20">
                        <!-- Navigation Header -->
                        <TextBlock Text="Navigation" 
                                   FontSize="16" FontWeight="Bold" 
                                   Foreground="#666" Margin="20,0,20,16"/>
                        
                        <!-- Core Modules -->
                        <TextBlock Text="Core Modules" 
                                   FontSize="14" FontWeight="SemiBold" 
                                   Foreground="#888" Margin="20,0,20,8"/>
                        
                        <Button Content="ðŸ“± Devices" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToDevicesCommand}"
                                Tag="Devices"/>
                        
                        <Button Content="ðŸ“¦ APK Files" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToApkFilesCommand}"
                                Tag="ApkFiles"/>
                        
                        <Button Content="â³ Install Queue" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToInstallQueueCommand}"
                                Tag="InstallQueue"/>
                        
                        <!-- Tools -->
                        <TextBlock Text="Tools" 
                                   FontSize="14" FontWeight="SemiBold" 
                                   Foreground="#888" Margin="20,16,20,8"/>
                        
                        <Button Content="ðŸ”§ Device Tools" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToDeviceToolsCommand}"
                                Tag="DeviceTools"/>
                        
                        <Button Content="ðŸ“¡ Wi-Fi ADB" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToWifiAdbCommand}"
                                Tag="WifiAdb"/>
                        
                        <Button Content="ðŸ“¸ Screenshots" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToScreenshotsCommand}"
                                Tag="Screenshots"/>
                        
                        <!-- Analysis -->
                        <TextBlock Text="Analysis" 
                                   FontSize="14" FontWeight="SemiBold" 
                                   Foreground="#888" Margin="20,16,20,8"/>
                        
                        <Button Content="ðŸ“Š Logcat" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToLogcatCommand}"
                                Tag="Logcat"/>
                        
                        <Button Content="ðŸ“‹ Installed Apps" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToInstalledAppsCommand}"
                                Tag="InstalledApps"/>
                        
                        <Button Content="ðŸ“ˆ Reports" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToReportsCommand}"
                                Tag="Reports"/>
                        
                        <!-- System -->
                        <TextBlock Text="System" 
                                   FontSize="14" FontWeight="SemiBold" 
                                   Foreground="#888" Margin="20,16,20,8"/>
                        
                        <Button Content="âš™ï¸ Settings" 
                                Style="{StaticResource NavigationButtonStyle}"
                                Command="{Binding NavigateToSettingsCommand}"
                                Tag="Settings"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
            <!-- Main Content Area -->
            <Border Grid.Column="1" 
                    Background="#F8F9FA" 
                    Padding="30">
                
                <Grid>
                    <!-- Welcome Screen (Default) -->
                    <Grid x:Name="WelcomeContent" 
                          Visibility="{Binding CurrentModule, Converter={StaticResource ModuleToVisibilityConverter}, ConverterParameter='Welcome'}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="Welcome to ADB Installer App" 
                                   FontSize="32" FontWeight="Bold" 
                                   Foreground="#333" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                        <TextBlock Text="Select a module from the navigation panel to get started." 
                                   FontSize="18" Foreground="#666" HorizontalAlignment="Center" Margin="0,0,0,32"/>
                        <TextBlock Text="ðŸš€" FontSize="80" HorizontalAlignment="Center" Margin="0,0,0,32"/>
                        <TextBlock Text="No module selected" 
                                   FontSize="20" FontWeight="Bold" 
                                   Foreground="#999" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                        <TextBlock Text="Choose a module from the left navigation panel to begin working with devices, APK files, or installation tasks." 
                                   FontSize="16" Foreground="#666" HorizontalAlignment="Center" 
                                   TextWrapping="Wrap" MaxWidth="500"/>
                    </StackPanel>
                </Grid>
                
                <!-- Devices Module -->
                <Grid x:Name="DevicesContent" 
                      Visibility="{Binding CurrentModule, Converter={StaticResource ModuleToVisibilityConverter}, ConverterParameter='Devices'}">
                                         <StackPanel>
                         <!-- Header Section -->
                         <Border CornerRadius="16" Padding="24" Margin="0,0,0,24">
                             <Border.Background>
                                 <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                     <GradientStop Color="#667eea" Offset="0"/>
                                     <GradientStop Color="#764ba2" Offset="1"/>
                                 </LinearGradientBrush>
                             </Border.Background>
                             <StackPanel>
                                 <TextBlock Text="ðŸ“± Connected Devices" 
                                            FontSize="28" FontWeight="Bold" 
                                            Foreground="White" Margin="0,0,0,8"/>
                                 <TextBlock Text="Manage and monitor your Android devices" 
                                            FontSize="16" Foreground="White" Opacity="0.9"/>
                             </StackPanel>
                         </Border>
                         
                         <!-- Device Controls -->
                         <Border Background="White" CornerRadius="12" Padding="20" Margin="0,0,0,20"
                                 Effect="{StaticResource CardShadow}">
                             <StackPanel Orientation="Horizontal">
                                 <Button Content="ðŸ”„ Refresh Devices" 
                                         Style="{StaticResource AccentButtonStyle}"
                                         Command="{Binding RefreshDevicesCommand}"
                                         FontSize="16" Padding="20,12" Margin="0,0,16,0"/>
                                 <Border Background="#F0F8FF" CornerRadius="8" Padding="16,12" 
                                         VerticalAlignment="Center">
                                     <TextBlock Text="{Binding DeviceStatusSummary, FallbackValue='No devices connected'}" 
                                                Foreground="#1976D2" FontSize="16" FontWeight="Medium"/>
                                 </Border>
                             </StackPanel>
                         </Border>
                        
                                                 <!-- Devices DataGrid -->
                         <Border Background="White" CornerRadius="12" Padding="20" Margin="0,0,0,20" 
                                 Effect="{StaticResource CardShadow}">
                             <DataGrid ItemsSource="{Binding Devices}" 
                                       AutoGenerateColumns="False" 
                                       CanUserAddRows="False"
                                       CanUserDeleteRows="False"
                                       CanUserResizeRows="False"
                                       GridLinesVisibility="None"
                                       HeadersVisibility="Column"
                                       SelectionMode="Single"
                                       Background="Transparent"
                                       RowBackground="Transparent"
                                       AlternatingRowBackground="#F8F9FA"
                                       RowHeight="40"
                                       FontSize="16"
                                       FontFamily="Segoe UI"
                                       BorderThickness="0"
                                       CanUserSortColumns="True"
                                       CanUserReorderColumns="True">
                                 <DataGrid.Columns>
                                     <DataGridCheckBoxColumn Binding="{Binding IsSelected}" 
                                                             Header="âœ“" Width="40" 
                                                             HeaderStyle="{StaticResource ModernDataGridHeaderStyle}"
                                                             ElementStyle="{StaticResource ModernDataGridCheckBoxStyle}"/>
                                     <DataGridTextColumn Binding="{Binding DisplayName}" 
                                                         Header="Device Name" Width="250" IsReadOnly="True"
                                                         HeaderStyle="{StaticResource ModernDataGridHeaderStyle}"
                                                         ElementStyle="{StaticResource ModernDataGridCellStyle}"/>
                                     <DataGridTextColumn Binding="{Binding DeviceInfo}" 
                                                         Header="Android Version" Width="180" IsReadOnly="True"
                                                         HeaderStyle="{StaticResource ModernDataGridHeaderStyle}"
                                                         ElementStyle="{StaticResource ModernDataGridCellStyle}"/>
                                     <DataGridTextColumn Binding="{Binding RootStatus}" 
                                                         Header="Root Status" Width="120" IsReadOnly="True"
                                                         HeaderStyle="{StaticResource ModernDataGridHeaderStyle}"
                                                         ElementStyle="{StaticResource ModernDataGridCellStyle}"/>
                                     <DataGridTextColumn Binding="{Binding Architecture}" 
                                                         Header="Architecture" Width="140" IsReadOnly="True"
                                                         HeaderStyle="{StaticResource ModernDataGridHeaderStyle}"
                                                         ElementStyle="{StaticResource ModernDataGridCellStyle}"/>
                                     <DataGridTextColumn Binding="{Binding State}" 
                                                         Header="Connection" Width="120" IsReadOnly="True"
                                                         HeaderStyle="{StaticResource ModernDataGridHeaderStyle}"
                                                         ElementStyle="{StaticResource ModernDataGridCellStyle}"/>
                                 </DataGrid.Columns>
                             </DataGrid>
                         </Border>
                    </StackPanel>
                </Grid>
                
                <!-- APK Files Module -->
                <Grid x:Name="ApkFilesContent" 
                      Visibility="{Binding CurrentModule, Converter={StaticResource ModuleToVisibilityConverter}, ConverterParameter='ApkFiles'}">
                    <StackPanel>
                        <TextBlock Text="ðŸ“¦ APK Repository" 
                                   FontSize="24" FontWeight="Bold" 
                                   Foreground="#333" Margin="0,0,0,20"/>
                        
                        <!-- Repository Controls -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <Button Content="ðŸ“ Choose APK Repository" 
                                    Style="{StaticResource ModernButtonStyle}"
                                    Command="{Binding ChooseRepoCommand}"
                                    Margin="0,0,12,0"/>
                            <TextBox Text="{Binding ApkRepoPath, FallbackValue='No folder selected'}" 
                                     Style="{StaticResource ModernTextBoxStyle}"
                                     IsReadOnly="True" Width="800" 
                                     VerticalAlignment="Center"
                                     Margin="0,0,12,0"/>
                            <Button Content="ðŸ”„ Rescan"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Command="{Binding RefreshRepoCommand}"/>
                        </StackPanel>
                        
                        <!-- APK Files DataGrid -->
                        <DataGrid ItemsSource="{Binding ApkFiles}" 
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserResizeRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  SelectionMode="Single"
                                  Background="White"
                                  RowBackground="White"
                                  AlternatingRowBackground="#F8F9FA">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Binding="{Binding IsSelected}" 
                                                        Header="âœ“" Width="40"/>
                                <DataGridTextColumn Binding="{Binding DisplayInfo}" 
                                                    Header="APK Info" Width="200" IsReadOnly="True"/>
                                <DataGridTextColumn Binding="{Binding FileSize}" 
                                                    Header="Size" Width="80" IsReadOnly="True"/>
                                <DataGridTextColumn Binding="{Binding LastModified}" 
                                                    Header="Modified" Width="120" IsReadOnly="True"/>
                                <DataGridTextColumn Binding="{Binding SplitTag}" 
                                                    Header="Split" Width="80" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Grid>
                
                <!-- Install Queue Module -->
                <Grid x:Name="InstallQueueContent" 
                      Visibility="{Binding CurrentModule, Converter={StaticResource ModuleToVisibilityConverter}, ConverterParameter='InstallQueue'}">
                    <StackPanel>
                        <TextBlock Text="â³ Installation Queue" 
                                   FontSize="24" FontWeight="Bold" 
                                   Foreground="#333" Margin="0,0,0,20"/>
                        
                        <!-- Installation Controls -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <Button Content="âš¡ Install on Selected Devices" 
                                    Style="{StaticResource AccentButtonStyle}"
                                    Command="{Binding InstallOnSelectedCommand}"
                                    FontSize="14" Padding="20,10" Margin="0,0,12,0"/>
                            <TextBlock Text="Select devices and APKs, then click Install" 
                                       Foreground="#666" VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <!-- Installation Options -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <CheckBox Content="Reinstall (-r)" 
                                      IsChecked="{Binding OptReinstall}" 
                                      Margin="0,0,16,0" VerticalAlignment="Center"/>
                            <CheckBox Content="Grant Permissions (-g)" 
                                      IsChecked="{Binding OptGrantPerms}" 
                                      Margin="0,0,16,0" VerticalAlignment="Center"/>
                            <CheckBox Content="Allow Downgrade (-d)" 
                                      IsChecked="{Binding OptDowngrade}"
                                      Margin="0,0,16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <!-- Queue Status -->
                        <Border Background="White" CornerRadius="8" Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Queue Status" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Devices.Count, FallbackValue=0}" FontSize="24" FontWeight="Bold" Foreground="#2196F3"/>
                                        <TextBlock Text="Devices" Foreground="#666"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding ApkFiles.Count, FallbackValue=0}" FontSize="24" FontWeight="Bold" Foreground="#4CAF50"/>
                                        <TextBlock Text="APKs" Foreground="#666"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                        <TextBlock Text="Ready" FontSize="24" FontWeight="Bold" Foreground="#FF9800"/>
                                        <TextBlock Text="Status" Foreground="#666"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Installation Log -->
                        <Border Background="White" CornerRadius="8" Padding="16">
                            <StackPanel>
                                <TextBlock Text="ðŸ“„ Installation Log" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                <Border Background="#1E1E1E" CornerRadius="4" Padding="12">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="200">
                                        <TextBlock Text="{Binding LogText, FallbackValue='No log entries yet'}" 
                                                   Background="Transparent"
                                                   Foreground="#FFFFFF"
                                                   FontFamily="Consolas" 
                                                   FontSize="12"
                                                   TextWrapping="Wrap"/>
                                    </ScrollViewer>
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
                
                <!-- Settings Module -->
                <Grid x:Name="SettingsContent" 
                      Visibility="{Binding CurrentModule, Converter={StaticResource ModuleToVisibilityConverter}, ConverterParameter='Settings'}">
                    <StackPanel>
                        <TextBlock Text="âš™ï¸ Settings" 
                                   FontSize="24" FontWeight="Bold" 
                                   Foreground="#333" Margin="0,0,0,20"/>
                        
                        <Border Background="White" CornerRadius="8" Padding="20">
                            <StackPanel>
                                <TextBlock Text="Application Settings" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,20"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="APK Repository:" VerticalAlignment="Center"/>
                                    <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal">
                                                                            <TextBox Text="{Binding ApkRepoPath, FallbackValue='No folder selected'}" 
                                             Style="{StaticResource ModernTextBoxStyle}"
                                             Width="300" Margin="0,0,8,0"/>
                                        <Button Content="Browse" 
                                                Style="{StaticResource ModernButtonStyle}"
                                                Command="{Binding ChooseRepoCommand}"/>
                                    </StackPanel>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Installation Options:" VerticalAlignment="Center" Margin="0,16,0,0"/>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,16,0,0">
                                        <CheckBox Content="Reinstall (-r)" 
                                                  IsChecked="{Binding OptReinstall}" 
                                                  Margin="0,0,16,0" VerticalAlignment="Center"/>
                                        <CheckBox Content="Grant Permissions (-g)" 
                                                  IsChecked="{Binding OptGrantPerms}" 
                                                  Margin="0,0,16,0" VerticalAlignment="Center"/>
                                        <CheckBox Content="Allow Downgrade (-d)" 
                                                  IsChecked="{Binding OptDowngrade}"
                                                  Margin="0,0,16,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Actions:" VerticalAlignment="Center" Margin="0,16,0,0"/>
                                    <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,16,0,0">
                                        <Button Content="Save Settings" 
                                                Style="{StaticResource AccentButtonStyle}"
                                                Command="{Binding SaveSettingsCommand}"
                                                Margin="0,0,12,0"/>
                                        <Button Content="Reset to Defaults" 
                                                Style="{StaticResource ModernButtonStyle}"
                                                Command="{Binding ResetToDefaultsCommand}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
                
                <!-- Other modules can be added here with similar structure -->
                
                </Grid>
            </Border>
        </Grid>
        
        <!-- Bottom Status Bar -->
        <Border Grid.Row="2" 
                Background="White" 
                BorderBrush="{StaticResource DividerBrush}" 
                BorderThickness="0,1,0,0"
                Padding="20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="Ready" 
                           VerticalAlignment="Center" 
                           Foreground="#666"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="ðŸ”„ Refresh All" 
                            Style="{StaticResource ModernButtonStyle}"
                            Command="{Binding RefreshAllCommand}"
                            Margin="0,0,8,0" Padding="12,6"/>
                    <Button Content="ðŸ“Š Status" 
                            Style="{StaticResource ModernButtonStyle}"
                            Command="{Binding ShowStatusCommand}"
                            Margin="0,0,8,0" Padding="12,6"/>
                    <Button Content="? Help" 
                            Style="{StaticResource ModernButtonStyle}"
                            Command="{Binding ShowHelpCommand}"
                            Padding="12,6"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>